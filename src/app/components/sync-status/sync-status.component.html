<div class="sync-status-card">
  <div class="sync-header">
    <h3>Figma Sync Status</h3>
    <div class="sync-actions">
      <button 
        class="sync-button" 
        [disabled]="syncStatus.isSyncing"
        (click)="startSync()">
        {{ syncStatus.isSyncing ? 'Syncing...' : 'Sync Now' }}
      </button>
    </div>
  </div>

  <div class="sync-info">
    <div class="status-indicator" [class]="getSyncStatusClass()">
      <span class="status-text">
        <span *ngIf="syncStatus.isSyncing" class="spinner">‚è≥</span>
        {{ getSyncStatusText() }}
      </span>
    </div>
    <div *ngIf="syncStatus.isSyncing" class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="syncStatus.syncProgress"></div>
      </div>
      <span class="progress-text">{{ syncStatus.syncProgress }}%</span>
    </div>
    <div class="data-counts">
              <span class="count-item">{{ syncStatus.dataCounts.tokens }} tokens</span>
        <span class="count-item">{{ syncStatus.dataCounts.components }} components</span>
        <span class="count-item">{{ syncStatus.dataCounts.pages }} pages</span>
    </div>
  </div>

  <!-- API Usage Monitor -->
  <div class="api-usage-section">
    <div class="section-header">
      <h4>API Usage</h4>
      <span class="status-badge" [class]="syncStatus.apiUsage.canMakeCalls ? 'safe' : 'warning'">
                  {{ syncStatus.apiUsage.canMakeCalls ? 'Safe' : 'Warning' }}
      </span>
    </div>
    
    <div class="api-stats">
      <div class="stat-item">
        <span class="stat-label">Calls this hour:</span>
        <span class="stat-value">{{ syncStatus.apiUsage.callsThisHour }}/{{ syncStatus.apiUsage.maxCallsPerHour }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Remaining calls:</span>
        <span class="stat-value" [class]="syncStatus.apiUsage.remainingCalls < 100 ? 'warning' : 'safe'">
          {{ syncStatus.apiUsage.remainingCalls }}
        </span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Cache status:</span>
        <span class="stat-value" [class]="syncStatus.cacheStatus.isValid ? 'safe' : 'warning'">
          {{ syncStatus.cacheStatus.isValid ? 'üü¢ Valid' : 'üü° Expired' }}
        </span>
      </div>
    </div>
  </div>

           <!-- Auto-Sync Controls -->
         <div class="auto-sync-section">
           <div class="auto-sync-header">
             <h4>ü§ñ Auto-Sync (Safe Mode)</h4>
             <button 
               class="auto-sync-toggle" 
               [class.enabled]="autoSyncStatus?.enabled"
               [disabled]="!syncStatus.canEnableAutoSync"
               (click)="toggleAutoSync()">
               {{ autoSyncStatus?.enabled ? 'ON' : 'OFF' }}
             </button>
           </div>
           
           <!-- Development Mode Warning -->
           <div class="dev-mode-warning" *ngIf="syncStatus.developmentMode && !syncStatus.canEnableAutoSync">
             <div class="warning-message">
               <span class="warning-icon">Warning</span>
               <span>Auto-sync disabled in development mode for safety</span>
             </div>
             <div class="warning-help">
               <small>To enable: Set DEV_DISABLE_AUTO_SYNC=false in server/.env</small>
             </div>
           </div>
    
    <div class="auto-sync-controls" *ngIf="autoSyncStatus?.enabled">
      <div class="interval-control">
        <label>Check every:</label>
        <input 
          type="number" 
          [value]="autoSyncStatus.interval / 1000"
          (change)="onIntervalChange($event)"
          min="2" 
          max="60"
          class="interval-input">
        <span>minutes (min: 2)</span>
      </div>
    </div>

    <div class="auto-sync-status">
      <div class="status-item">
        <span class="status-label">Status:</span>
        <span class="status-value" [class]="autoSyncStatus?.enabled ? 'active' : 'inactive'">
          {{ autoSyncStatus?.enabled ? 'üü¢ Active' : 'üî¥ Inactive' }}
        </span>
      </div>
      <div class="status-item" *ngIf="autoSyncStatus?.lastAutoSync">
        <span class="status-label">Last auto-sync:</span>
        <span class="status-value">{{ autoSyncStatus?.lastAutoSync | date:'short' }}</span>
      </div>
    </div>
  </div>
</div> 